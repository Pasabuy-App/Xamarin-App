<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:d="http://xamarin.com/schemas/2014/forms/design"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             x:Class="PasaBuy.App.Views.Feeds.HomePage" 
             xmlns:listView="clr-namespace:Syncfusion.ListView.XForms;assembly=Syncfusion.SfListView.XForms"
             xmlns:converter="clr-namespace:PasaBuy.App.Converters"
             xmlns:border="clr-namespace:Syncfusion.XForms.Border;assembly=Syncfusion.Core.XForms"
             xmlns:posts="clr-namespace:PasaBuy.App.ViewModels.Feeds"
             xmlns:ffimageloading="clr-namespace:FFImageLoading.Forms;assembly=FFImageLoading.Forms"
             xmlns:shimmer="clr-namespace:Syncfusion.XForms.Shimmer;assembly=Syncfusion.Core.XForms"
             BackgroundColor="{DynamicResource Gray-300}"
             xmlns:local="clr-namespace:PasaBuy.App.Views.Feeds.Templates" xmlns:buttons="clr-namespace:Syncfusion.XForms.Buttons;assembly=Syncfusion.Buttons.XForms"
             NavigationPage.TitleIconImageSource="LogoHeader.png">

    <ContentView.Resources>
        <ResourceDictionary>
            <converter:BooleanToColorConverter x:Key="ColorConverter" />
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Styles.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </ContentView.Resources>

    <ContentView.BindingContext>
        <posts:HomepageViewModel />
    </ContentView.BindingContext>

    <ContentView.Content>
        
        <RefreshView IsRefreshing="{Binding IsRefreshing}"   
                     x:Name="rv"
                     Command="{Binding RefreshCommand}">

            <ScrollView VerticalScrollBarVisibility="Never" Padding="0, 0, 0, 20">

                <Grid RowSpacing="10" ColumnSpacing="0" TranslationY="-10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                    
                    <!-- INPUT VIEW -->
                    
                            <StackLayout Grid.Row="1" 
                                     BackgroundColor="{DynamicResource Gray-100}">
                                <local:InputEntry/>
                            </StackLayout>
                    
                            <!-- FEED VIEW -->
                            <StackLayout Grid.Row="2">
                        <!--<local:PostEntry/>-->
                        <listView:SfListView x:Name="homeListView" ItemAppearing="homeListView_ItemAppearing"
                                             ItemsSource="{Binding HomePosts}"
                                             AutoFitMode="DynamicHeight">
                            <listView:SfListView.ItemTemplate>
                                <DataTemplate>
                                    
                                    <Grid RowSpacing="0"  
                                          Margin="0,0,0,10"
                                          BackgroundColor="{DynamicResource Gray-100}">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <StackLayout Grid.Row="0" Grid.ColumnSpan="2">
                                            <Grid Padding="20">

                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                </Grid.RowDefinitions>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="15"/>
                                                </Grid.ColumnDefinitions>

                                                <Grid Grid.Row="0" 
                                                      Grid.RowSpan="2"
                                                      Margin="0, 0, 5, 0"
                                                      VerticalOptions="StartAndExpand">

                                                    <border:SfBorder CornerRadius="50"
                                                                     border:BorderColor="White" 
                                                                     BorderWidth="2">
                                                        <Image WidthRequest="40" HeightRequest="40"
                                                               BackgroundColor="{DynamicResource Gray-400}">
                                                            <Image.Source>
                                                                <UriImageSource
                                                                    CacheValidity="14"
                                                                    CachingEnabled="true"
                                                                    Uri="{Binding Photo}" />
                                                            </Image.Source>
                                                        </Image>
                                                    </border:SfBorder>
                                                </Grid>

                                                <Grid Grid.Row="0" 
                                                      HeightRequest="25"
                                                      Grid.Column="1">

                                                    <buttons:SfButton
                                                                  BorderWidth="0" 
                                                                  WidthRequest="210" 
                                                                  HeightRequest="40"
                                                                  BackgroundColor="Transparent"
                                                                  FontSize="15"
                                                                  CornerRadius="4" Clicked="SfButton_Clicked" ClassId="{Binding Post_author}"
                                                                  HorizontalOptions="End">

                                                        <Label Text="{Binding Author}" Style="{StaticResource PostAuthor}"/>

                                                    </buttons:SfButton>
                                                    
                                                </Grid>
                                                
                                                <Grid Grid.Row="1" 
                                                      HeightRequest="20"
                                                      Grid.Column="1">
                                                    <Label Text="{Binding Date}" Style="{StaticResource PostDate}"/>
                                                </Grid>

                                                <Grid Grid.Row="0" 
                                                      HeightRequest="20"
                                                      Grid.Column="2" 
                                                      HorizontalOptions="End">
                                                    <Label Text="{Binding Types}" Style="{StaticResource PostType}"/>
                                                </Grid>
                                                <Grid Grid.Row="1" 
                                                      HeightRequest="20"
                                                      Grid.Column="2"
                                                      HorizontalOptions="End">
                                                    <Label Text="{Binding Seen}" Style="{StaticResource PostSeen}"/>
                                                </Grid>

                                                <Grid Grid.Row="0" 
                                                    WidthRequest="12"
                                                    Grid.RowSpan="2"
                                                    Grid.Column="3" 
                                                    Margin="5, 0, 0, 0"
                                                    HorizontalOptions="End">
                                                    <Label Text=":" Style="{StaticResource HeaderLabelStyle}"/>
                                                </Grid>

                                            </Grid>
                                        </StackLayout>

                                        <Grid Grid.Row="1" 
                                              Padding="30, 5, 30, 25"
                                              Grid.ColumnSpan="2">
                                            <StackLayout>
                                                <Label Text="{Binding Title}" Style="{StaticResource PostTitle}"/>
                                                <Label Text="{Binding Description}" Style="{StaticResource PostDescription}" IsVisible="{Binding isContent}"/>
                                                <Label Margin="0,-2,0,0" Text="{Binding Vehicle}" Style="{StaticResource PostDescription}" TextType="Html" IsVisible="{Binding isContent}"/>
                                                <Label Margin="0,-5,0,0" Text="{Binding PickUp}" Style="{StaticResource PostDescription}" TextType="Html" IsVisible="{Binding isContent}"/>
                                                <Label Margin="0,-5,0,0" Text="{Binding DO_Price}" Style="{StaticResource PostDescription}" TextType="Html" IsVisible="{Binding isContent}"/>
                                            </StackLayout>
                                        </Grid>

                                        <Grid Grid.Row="2" IsVisible="{Binding isImage}"
                                            Grid.ColumnSpan="2"
                                            HorizontalOptions="FillAndExpand"
                                            VerticalOptions="FillAndExpand">
                                            
                                            <!--<Image Aspect="AspectFill"
                                                   HeightRequest="{Binding ImageHeight}"
                                                   HorizontalOptions="FillAndExpand"
                                                   VerticalOptions="FillAndExpand"
                                                   BackgroundColor="{DynamicResource Transparent}">
                                                <Image.Source>
                                                    <UriImageSource  CacheValidity="14"
                                                        CachingEnabled="true"
                                                        Uri="{Binding Images}" />
                                                </Image.Source>
                                            </Image>-->
                                            <ffimageloading:CachedImage 
                                                Aspect="AspectFill"
			                                    DownsampleToViewSize="true"
                                                HeightRequest="{Binding ImageHeight}"
                                                HorizontalOptions="FillAndExpand"
                                                VerticalOptions="FillAndExpand"
                                                x:Name="HomeImages"
                                                LoadingPlaceholder="https://i2.wp.com/seds.org/wp-content/uploads/2020/06/placeholder.png?fit=1200%2C800&amp;ssl=1"
                                                BackgroundColor="{DynamicResource Transparent}"
                                                Source="{Binding Images}"
                                                CacheDuration="30.00:00:00">
                                            </ffimageloading:CachedImage>
                                        </Grid>

                                        <Grid Grid.Row="3" Grid.ColumnSpan="2" 
                                          ColumnSpacing="0"
                                          RowSpacing="0">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <Grid Grid.Row="1" Grid.Column="0">
                                                <Button Text="Accept" 
                                                    IsEnabled="{Binding isAccept}"
                                                    BorderColor="{DynamicResource Gray-300}"
                                                    BorderWidth="1"
                                                    BackgroundColor="{DynamicResource Gray-100}"/>
                                            </Grid>
                                            <Grid Grid.Row="1" Grid.Column="{Binding HomeCol}" Grid.ColumnSpan="{Binding HomeColSpan}">
                                                <Button Text="Share" x:Name="ShareButton" ClassId="{Binding LinkPost}"
                                                    Clicked="Button_Clicked"
                                                    IsEnabled="True"
                                                    BorderColor="{DynamicResource Gray-300}"
                                                    BorderWidth="1"
                                                    BackgroundColor="{DynamicResource Gray-100}"/>
                                            </Grid>
                                        </Grid>

                                    </Grid>
                                </DataTemplate>
                            </listView:SfListView.ItemTemplate>
                        </listView:SfListView>
                    </StackLayout>
                        
                </Grid>

        </ScrollView>
        
        </RefreshView>
    </ContentView.Content>
    
</ContentView>